services:
  backend:
    ports:
      - "8081:8081"

  frontend-dev:
    image: node:20
    container_name: linklytics-frontend-dev
    working_dir: /app
    volumes:
      - ./url-shortener-react:/app
      - /app/node_modules
    environment:
      VITE_API_BASE_URL: ${VITE_API_BASE_URL}
      VITE_REDIRECT_BASE_URL: ${VITE_REDIRECT_BASE_URL}
      CHOKIDAR_USEPOLLING: "true"
    command: ["sh","-lc","test -x node_modules/.bin/vite || npm install; exec npm run dev -- --host 0.0.0.0 --port 5174 --strictPort"]
    ports:
      - "5174:5174"
    depends_on:
      backend:
        condition: service_healthy
    restart: unless-stopped
